extends layout

block content
  .container.mx-auto.px-4.py-8
    .max-w-4xl.mx-auto
      // Header Card
      .card.bg-gradient-to-r.from-primary.to-secondary.text-primary-content.shadow-xl.mb-8
        .card-body.text-center
          .avatar.placeholder.mx-auto.mb-4
            .bg-neutral.text-neutral-content.rounded-full.w-24
              span.text-4xl= user.name.charAt(0).toUpperCase()
          h1.text-3xl.font-bold= user.name
          p.text-lg.opacity-90= user.email
          if user.isAdmin
            .badge.badge-accent.badge-lg.gap-2.mt-2
              i.fas.fa-crown
              | Quản trị viên

      .grid.gap-6(class='lg:grid-cols-2')
        // Update Profile
        .card.bg-base-100.shadow-xl
          .card-body
            h2.card-title
              i.fas.fa-user-edit.mr-2
              | Cập Nhật Thông Tin
            if error
              .alert.alert-error
                i.fas.fa-exclamation-circle
                span= error
            form(method='post', action='/me', class='space-y-4')
              .form-control
                label.label
                  span.label-text
                    i.fas.fa-user.mr-2
                    | Họ và tên
                input.input.input-bordered.input-primary(type='text', name='name', value=user.name, required)
              
              .form-control
                label.label
                  span.label-text
                    i.fas.fa-calendar.mr-2
                    | Năm sinh
                input.input.input-bordered(type='number', name='YOB', value=user.YOB || '', placeholder='Nhập năm sinh', min='1900', max='2100')
              
              .form-control
                label.label
                  span.label-text
                    i.fas.fa-venus-mars.mr-2
                    | Giới tính
                select.select.select-bordered(name='gender', id='genderSelect')
                  option(value='') Không xác định
                  option(value='true') Nam
                  option(value='false') Nữ
              
              .card-actions.justify-end
                button.btn.btn-primary(type='submit')
                  i.fas.fa-save.mr-2
                  | Lưu thay đổi

        // Change Password
        .card.bg-base-100.shadow-xl
          .card-body
            h2.card-title
              i.fas.fa-key.mr-2
              | Đổi Mật Khẩu
            form(method='post', action='/me/password', class='space-y-4')
              .form-control
                label.label
                  span.label-text
                    i.fas.fa-lock.mr-2
                    | Mật khẩu hiện tại
                input.input.input-bordered.input-primary(type='password', name='currentPassword', required)
              
              .form-control
                label.label
                  span.label-text
                    i.fas.fa-lock.mr-2
                    | Mật khẩu mới
                input.input.input-bordered.input-primary(type='password', name='newPassword', minlength='6', required)
                label.label
                  span.label-text-alt.opacity-70 Ít nhất 6 ký tự
              
              .card-actions.justify-end
                button.btn.btn-secondary(type='submit')
                  i.fas.fa-key.mr-2
                  | Đổi mật khẩu

      // Account Info Display
      .stats.shadow.w-full.mt-8
        .stat
          .stat-figure.text-primary
            i.fas.fa-user.text-3xl
          .stat-title Họ và Tên
          .stat-value.text-lg= user.name
        .stat
          .stat-figure.text-secondary
            i.fas.fa-calendar.text-3xl
          .stat-title Năm Sinh
          .stat-value.text-lg= user.YOB || 'Chưa cập nhật'
        .stat
          .stat-figure.text-accent
            i.fas.fa-venus-mars.text-3xl
          .stat-title Giới Tính
          - const displayGender = user.gender === true ? 'Nam' : user.gender === false ? 'Nữ' : 'Chưa xác định'
          .stat-value.text-lg= displayGender

  script.
    // Set gender select value correctly
    document.addEventListener('DOMContentLoaded', function() {
      const user = !{JSON.stringify(user)};
      const genderSelect = document.getElementById('genderSelect');
      
      console.log('User data:', user);
      console.log('Gender value:', user.gender);
      
      if (genderSelect && user) {
        if (user.gender === true) {
          genderSelect.value = 'true';
        } else if (user.gender === false) {
          genderSelect.value = 'false';
        } else {
          genderSelect.value = '';
        }
        console.log('Gender select set to:', genderSelect.value);
      }
    });
